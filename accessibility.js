document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') document.body.focus(); }); window.addEventListener('load', ()=>{ const toggle = document.getElementById('toggle-theme'); const contrast = document.getElementById('toggle-contrast'); const storedTheme = localStorage.getItem('theme'); const storedContrast = localStorage.getItem('contrast'); if(storedTheme) document.documentElement.setAttribute('data-theme', storedTheme); if(storedContrast==='high') document.documentElement.setAttribute('data-contrast','high'); if(toggle) toggle.addEventListener('click', ()=>{ const is = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', is); toggle.setAttribute('aria-pressed', is==='dark'); localStorage.setItem('theme', is); }); if(contrast) contrast.addEventListener('click', ()=>{ const is = document.documentElement.getAttribute('data-contrast') === 'high' ? 'normal' : 'high'; if(is==='high') document.documentElement.setAttribute('data-contrast','high'); else document.documentElement.removeAttribute('data-contrast'); contrast.setAttribute('aria-pressed', is==='high'); localStorage.setItem('contrast', is); }); document.body.addEventListener('keydown', (e)=>{ if(e.key === 'Tab') document.documentElement.classList.add('user-is-tabbing'); }, {once:true}); });