import {validateForm} from './validation.js'; export const Cadastro = { init(){ window.addEventListener('view:changed', e=>{ if(e.detail.view==='tpl-cadastro') this.mount(); }); if(location.hash.includes('cadastro')) window.addEventListener('load', ()=> this.mount()); }, mount(){ const form = document.getElementById('cadastro-form'); const limparBtn = document.getElementById('limpar-dados'); this.loadList(); form.addEventListener('submit', ev=>{ ev.preventDefault(); if(!validateForm(form)){ this.toast('Preencha corretamente o formulário.'); return; } const data = { nome: form.nome.value.trim(), email: form.email.value.trim(), telefone: form.telefone.value.trim(), cpf: form.cpf.value.trim(), criadoEm: new Date().toISOString() }; const arr = JSON.parse(localStorage.getItem('cadastros')||'[]'); arr.push(data); localStorage.setItem('cadastros', JSON.stringify(arr)); this.toast('Cadastro salvo com sucesso.'); form.reset(); this.loadList(); }); limparBtn.addEventListener('click', ()=>{ if(confirm('Deseja realmente apagar todos os cadastros?')){ localStorage.removeItem('cadastros'); this.loadList(); this.toast('Dados apagados.'); } }); }, loadList(){ const list = document.getElementById('cadastros-list'); const arr = JSON.parse(localStorage.getItem('cadastros')||'[]'); if(!list) return; if(arr.length===0){ list.innerHTML='<p class="card">Nenhum cadastro.</p>'; return; } list.innerHTML = '<div class="card" role="list">'+arr.map((c,i)=>`<div class="cad-item" role="listitem"><strong>${c.nome}</strong> — ${c.email} <br><small>${c.telefone} • ${c.cpf}</small></div>`).join('')+'</div>'; }, toast(msg){ const existing = document.querySelector('.toast'); if(existing) existing.remove(); const d = document.createElement('div'); d.className='toast'; d.textContent=msg; document.body.appendChild(d); setTimeout(()=>d.remove(),3000); } };